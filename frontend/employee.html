<!DOCTYPE html>
<html>
<head>
    <title>Employee Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>

<body>
<nav class="navbar navbar-dark bg-primary px-3">
    <h4 class="text-white">Employee Dashboard</h4>
    <button class="btn btn-light" onclick="logout()">Logout</button>
</nav>

<div class="container mt-4">

    <h5>Welcome, <span id="empName"></span></h5>
    <hr>

    <!-- Attendance -->
    <button class="btn btn-success mb-3" onclick="markAttendance()">Mark Attendance</button>

    <!-- Timesheet -->
    <h6>Submit Timesheet</h6>
    <input type="date" id="tsDate" class="form-control mb-2">
    <input type="text" id="tsProject" class="form-control mb-2" placeholder="Project">
    <input type="number" id="tsHours" class="form-control mb-2" placeholder="Hours">
    <button class="btn btn-primary" onclick="submitTimesheet()">Submit</button>

    <hr>

    <!-- Leave -->
    <h6>Apply Leave</h6>
    <input type="date" id="lvFrom" class="form-control mb-2">
    <input type="date" id="lvTo" class="form-control mb-2">
    <input type="text" id="lvReason" class="form-control mb-2" placeholder="Reason">
    <button class="btn btn-warning" onclick="applyLeave()">Apply Leave</button>

    <hr>

    <a class="btn btn-info" href="chatbot.html">Ask Chatbot ðŸ¤–</a>

</div>

<script>
let user = JSON.parse(localStorage.getItem("user"));
document.getElementById("empName").innerText = user.name;

function logout(){
    localStorage.clear();
    window.location = "index.html";
}

// Attendance
function markAttendance(){
    fetch("http://localhost:5000/attendance/mark", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ employee_id: user.id })
    });
    alert("Attendance marked!");
}

// Timesheet
function submitTimesheet(){
    fetch("http://localhost:5000/timesheet/add", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
            employee_id: user.id,
            date: tsDate.value,
            project: tsProject.value,
            hours: tsHours.value
        })
    });
    alert("Timesheet submitted!");
}

// Leave
function applyLeave(){
    fetch("http://localhost:5000/leave/apply", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
            employee_id: user.id,
            from_date: lvFrom.value,
            to_date: lvTo.value,
            type: "General",
            reason: lvReason.value
        })
    });
    alert("Leave Applied!");
}
</script>

</body>
</html>
